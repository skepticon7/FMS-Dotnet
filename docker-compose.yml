networks:
  proxybackend:
    driver: bridge

volumes:
  consul-data:
    driver: local

services:
  consul:
    image: hashicorp/consul
    container_name: FMS.Consul
    ports:
      - "8500:8500"
    networks:
      - proxybackend
    volumes:
      - consul-data:/consul/data
    command: >
      agent 
      -server 
      -bootstrap 
      -ui 
      -client=0.0.0.0 
      -hcl='server_rejoin_age_max = "8760h"'
    
   

    
  ocelot.gateway:
    build:
      context: .
      dockerfile: /backend/OcelotGateway/OcelotGateway.Api/Dockerfile
    container_name: OCELOT.Gateway
    ports:
      - "5050:8080"
      - "5051:8081"
    networks:
      - proxybackend
    depends_on:
      - consul
  
        
  redis:
    image: "redis:7.0-alpine"
    container_name: redis
    ports:
      - "6379:6379"
    command: >
      redis-server 
      --appendonly no
    depends_on:
      - consul
        
  redis-insight:
    image : redis/redisinsight:latest
    container_name: redis-insight
    ports:
      - "5540:5540"
    depends_on:
      - redis
      - consul
        
  rabbitmq:
    image: rabbitmq:3-management
    container_name: rabbitmq
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest
    depends_on:
      - consul

  
  
    
#  users.api:
#    build:
#        context: .
#        dockerfile: backend/UserService/Dockerfile
#    container_name: user-service
#    hostname: user-service
#    ports:
#      - "5034:8080"
#    networks:
#      - proxybackend
#    depends_on:
#      - consul